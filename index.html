<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>My Vocab Ultimate</title>

<style>
*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,sans-serif}
body{margin:0;background:#f3f5f9}

header{position:sticky;top:0;background:#fff;padding:14px;
box-shadow:0 2px 6px rgba(0,0,0,.08);z-index:10}

h1{margin:0;font-size:22px}
.count{font-size:13px;color:#666;margin-top:2px}

.controls{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
button{border:none;border-radius:10px;padding:10px 12px;font-size:14px}

.import{background:#1e88e5;color:#fff}
.export{background:#6a5acd;color:#fff}
.deleteall{background:#e53935;color:#fff}
.favbtn{background:#f39c12;color:#fff}
.refresh{background:#27ae60;color:#fff}
.add{background:#e3f2fd}

.search{margin-top:10px;width:100%;padding:12px;border-radius:12px;
border:1px solid #ccc;font-size:16px}

main{padding:14px}

.card{background:#fff;border-radius:14px;padding:14px;margin-bottom:12px;position:relative}

.word{font-weight:700;font-size:18px}
.pron{color:#666;margin-top:2px;word-break:break-word}
.meaning{margin-top:2px;word-break:break-word}

.icons{margin-top:6px}
.icons span{font-size:20px;margin-right:8px}

.star{position:absolute;right:12px;top:12px;font-size:22px;cursor:pointer}

.modal{position:fixed;inset:0;background:rgba(0,0,0,.35);
display:none;align-items:center;justify-content:center;padding:14px;z-index:99}

.modal-content{background:#fff;border-radius:16px;padding:14px;width:100%;
max-width:420px;max-height:90vh;overflow:auto}

.modal-content input, .modal-content textarea{
width:100%;margin-bottom:10px;padding:12px 14px;
border-radius:10px;border:1px solid #ccc;font-size:16px
}

.ipa{font-family:Arial,Helvetica,sans-serif}

.modal-actions{display:flex;gap:10px;margin-top:6px}
.modal-actions button{flex:1}

.save{background:#1e88e5;color:#fff}
.delete{background:#e53935;color:#fff}
.cancel{background:#bbb}
.audio{background:#2ecc71;color:#fff}

#pscore{font-weight:600;margin-top:6px}
</style>
</head>

<body>

<header>
<h1>ğŸ“˜ My Vocab Ultimate</h1>
<div class="count" id="count">Total vocabulary: 0 words</div>

<div class="controls">
<button class="import" onclick="importCSV()">ğŸ“¥ Import</button>
<button class="export" onclick="exportCSV()">ğŸ“¤ Export</button>
<button class="deleteall" onclick="deleteAll()">ğŸ§¨ Delete All</button>
<button class="favbtn" onclick="toggleFavView()">â­ Favorites</button>
<button class="refresh" onclick="resetView()">ğŸ”„</button>
<button class="add" onclick="openModal()">ï¼‹</button>
<button class="refresh" onclick="openPron()">ğŸ¤ Pronounce</button>
</div>

<input class="search" id="search" placeholder="Search word or meaning..." oninput="render()">
</header>

<main id="list"></main>

<!-- VOCAB MODAL -->
<div class="modal" id="modal">
<div class="modal-content">

<input id="word" placeholder="Word">
<input id="pron" class="ipa" placeholder="Pronunciation">
<textarea id="meaning" rows="2" placeholder="Meaning"></textarea>

<textarea id="ex1" rows="2" placeholder="Example 1"></textarea>
<textarea id="ipa1" class="ipa" rows="2" placeholder="IPA Example 1"></textarea>
<textarea id="tr1" rows="2" placeholder="Translation 1"></textarea>

<textarea id="ex2" rows="2" placeholder="Example 2"></textarea>
<textarea id="ipa2" class="ipa" rows="2" placeholder="IPA Example 2"></textarea>
<textarea id="tr2" rows="2" placeholder="Translation 2"></textarea>

<div class="modal-actions">
<button class="audio" onclick="speakExample(1)">ğŸ”Š Example1</button>
<button class="audio" onclick="speakExample(2)">ğŸ”Š Example2</button>
</div>

<div class="modal-actions">
<button class="save" onclick="save()">Save</button>
<button class="delete" onclick="remove()">Delete</button>
<button class="cancel" onclick="closeModal()">Cancel</button>
</div>

</div>
</div>

<!-- PRON MODAL -->
<div class="modal" id="pronModal">
<div class="modal-content">

<input id="pword" placeholder="Type word and press Enter">
<div id="pipa" class="ipa"></div>

<div class="modal-actions">
<button class="audio" onclick="hearWord()">ğŸ”Š Hear</button>
<button class="audio" onclick="startPron()">ğŸ™ Speak</button>
</div>

<div id="pscore"></div>

<div class="modal-actions">
<button class="cancel" onclick="closePron()">Close</button>
</div>

</div>
</div>

<script>
let data=JSON.parse(localStorage.getItem("vocab")||"[]")
let editIndex=null
let favOnly=false

function render(){
const list=document.getElementById("list")
const q=document.getElementById("search").value.toLowerCase()
list.innerHTML=""

let arr=data.filter(v=>{
if(favOnly && !v.fav) return false
return v.word.toLowerCase().includes(q) ||
(v.meaning||"").toLowerCase().includes(q)
})

document.getElementById("count").innerText=`Total vocabulary: ${data.length} words`

arr.forEach(v=>{
const i=data.indexOf(v)
const d=document.createElement("div")
d.className="card"
d.innerHTML=`
<div class="word">${v.word}</div>
<div class="pron">${v.pron||""}</div>
<div class="meaning">${v.meaning||""}</div>

<div class="icons">
<span onclick="speak('${v.word}')">ğŸ”Š</span>
<span onclick="speakSlow('${v.word}')">ğŸ¢</span>
<span onclick="edit(${i})">âœï¸</span>
</div>

<div class="star" onclick="toggleFav(${i})">${v.fav?"â­":"â˜†"}</div>
`
list.appendChild(d)
})

localStorage.setItem("vocab",JSON.stringify(data))
}

function openModal(){
editIndex=null
word.value=pron.value=meaning.value=""
ex1.value=ipa1.value=tr1.value=""
ex2.value=ipa2.value=tr2.value=""
modal.style.display="flex"
}

function closeModal(){modal.style.display="none"}

function save(){
const v={
word:word.value,
pron:pron.value,
meaning:meaning.value,
ex1:ex1.value,
ipa1:ipa1.value,
tr1:tr1.value,
ex2:ex2.value,
ipa2:ipa2.value,
tr2:tr2.value,
fav:editIndex!==null?data[editIndex].fav:false
}
if(editIndex===null)data.push(v)
else data[editIndex]=v
closeModal();render()
}

function edit(i){
editIndex=i
const v=data[i]
word.value=v.word||""
pron.value=v.pron||""
meaning.value=v.meaning||""
ex1.value=v.ex1||""
ipa1.value=v.ipa1||""
tr1.value=v.tr1||""
ex2.value=v.ex2||""
ipa2.value=v.ipa2||""
tr2.value=v.tr2||""
modal.style.display="flex"
}

function remove(){
if(editIndex!==null){data.splice(editIndex,1);closeModal();render()}
}

function deleteAll(){if(confirm("Delete all vocabulary?")){data=[];render()}}
function toggleFav(i){data[i].fav=!data[i].fav;render()}
function toggleFavView(){favOnly=!favOnly;render()}
function resetView(){favOnly=false;search.value="";render()}

function speak(t){speechSynthesis.speak(new SpeechSynthesisUtterance(t))}
function speakSlow(t){let u=new SpeechSynthesisUtterance(t);u.rate=0.6;speechSynthesis.speak(u)}
function speakExample(n){if(n===1&&ex1.value)speak(ex1.value);if(n===2&&ex2.value)speak(ex2.value)}

function exportCSV(){
let csv="word,pronunciation,meaning,example1,ipa1,translation1,example2,ipa2,translation2,fav\n"
data.forEach(v=>{
csv+=`"${v.word}","${v.pron}","${v.meaning}","${v.ex1}","${v.ipa1}","${v.tr1}","${v.ex2}","${v.ipa2}","${v.tr2}","${v.fav?1:0}"\n`
})
const a=document.createElement("a")
a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}))
a.download="my-vocab-Ultimate.csv"
a.click()
}

function importCSV(){
const i=document.createElement("input")
i.type="file";i.accept=".csv"
i.onchange=e=>{
const r=new FileReader()
r.onload=()=>{
const lines=r.result.split(/\r?\n/).slice(1)
data=[]
lines.forEach(l=>{
if(!l.trim())return
const c=l.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g)
if(!c)return
data.push({
word:c[0].replace(/"/g,""),
pron:c[1].replace(/"/g,""),
meaning:c[2].replace(/"/g,""),
ex1:c[3].replace(/"/g,""),
ipa1:c[4].replace(/"/g,""),
tr1:c[5].replace(/"/g,""),
ex2:c[6].replace(/"/g,""),
ipa2:c[7].replace(/"/g,""),
tr2:c[8].replace(/"/g,""),
fav:c[9]=="1"
})
})
render()
alert("Import success âœ…")
}
r.readAsText(e.target.files[0])
}
i.click()
}

render()

// ===== PRONOUNCE TRAINER =====

function openPron(){
pronModal.style.display="flex"
pword.value=""
pipa.innerText=""
pscore.innerText=""
}

function closePron(){pronModal.style.display="none"}

const ipaDict={
ambitious:"/Ã¦mËˆbÉªÊƒÉ™s/",
multitask:"/ËŒmÊŒltiËˆtÃ¦sk/",
porridge:"/ËˆpÉ’rÉªdÊ’/",
chambermaid:"/ËˆtÊƒeÉªmbÉ™rmeÉªd/",
productive:"/prÉ™ËˆdÊŒktÉªv/"
}

pword.addEventListener("keypress",e=>{
if(e.key==="Enter"){
const w=pword.value.toLowerCase().trim()
pipa.innerText=ipaDict[w]||"(IPA not found)"
}
})

function hearWord(){
if(!pword.value)return
speechSynthesis.speak(new SpeechSynthesisUtterance(pword.value))
}

function startPron(){
if(!pword.value)return

const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition
if(!SpeechRecognition){
alert("Speech recognition not supported")
return
}

const rec=new SpeechRecognition()
rec.lang="en-US"
rec.start()

rec.onresult=e=>{
const said=e.results[0][0].transcript.toLowerCase()
const target=pword.value.toLowerCase()

if(said===target){
playCling()
pscore.innerText="âœ… Correct"
}else{
playBeep()
pscore.innerText="âŒ You said: "+said
}
}
}

function playBeep(){
const ctx=new AudioContext()
const o=ctx.createOscillator()
o.type="sine"
o.frequency.value=200
o.connect(ctx.destination)
o.start()
setTimeout(()=>o.stop(),200)
}

function playCling(){
const ctx=new AudioContext()
const o=ctx.createOscillator()
o.type="triangle"
o.frequency.value=800
o.connect(ctx.destination)
o.start()
setTimeout(()=>o.stop(),200)
}
</script>
</body>
</html>