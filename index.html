<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Vocab Ultra</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  background: #f5f5f5;
}

header {
  background: #fff;
  padding: 10px;
  border-bottom: 1px solid #ddd;
}

h1 {
  margin: 0;
  font-size: 20px;
}

#count {
  color: #666;
  font-size: 12px;
}

.toolbar {
  display: flex;
  gap: 6px;
  padding: 8px;
  background: #fafafa;
  border-bottom: 1px solid #ddd;
}

button {
  border: 1px solid #ccc;
  background: white;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
}

button:hover {
  background: #f0f0f0;
}

.container {
  padding: 10px;
}

.word {
  background: white;
  padding: 8px;
  margin-bottom: 6px;
  border-radius: 6px;
  border: 1px solid #ddd;
}

.term {
  font-weight: bold;
  cursor: pointer;
}

.meaning {
  color: #555;
  font-size: 14px;
}

.actions {
  margin-top: 6px;
  display: flex;
  gap: 6px;
}

.modal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.3);
  display: none;
  align-items: center;
  justify-content: center;
}

.modal-content {
  background: white;
  padding: 10px;
  border-radius: 8px;
  width: 300px;
}

.modal-content input {
  width: 100%;
  margin-bottom: 6px;
  padding: 6px;
  border: 1px solid #ccc;
  border-radius: 6px;
}

.modal-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 6px;
}

/* TEST PANEL */
#testPanel {
  display: none;
  padding: 16px;
  background: #eee;
  border-top: 1px solid #ddd;
}

#testWord {
  font-size: 42px;
  font-weight: bold;
}

#testIPA {
  font-size: 26px;
  color: #666;
  margin-bottom: 14px;
}

#result {
  margin-top: 14px;
  font-size: 28px;
}

#score {
  font-size: 22px;
  color: #666;
}
</style>
</head>

<body>

<header>
  <h1>My Vocab Ultra</h1>
  <div id="count">Total vocabulary: 0</div>
</header>

<div class="toolbar">
  <button onclick="importData()">Import</button>
  <button onclick="exportData()">Export</button>
  <button onclick="deleteAll()">Delete All</button>
  <button onclick="showFavorites()">⭐ Favorites</button>
  <button onclick="togglePronunciation()">Pronunciation</button>
  <button onclick="openModal()">＋</button>
</div>

<div class="container" id="list"></div>

<!-- TEST PANEL -->
<div id="testPanel">
  <div style="text-align:center;">
    <div id="testWord">able</div>
    <div id="testIPA">/ˈeɪ.bəl/</div>

    <div style="display:flex; gap:10px;">
      <button style="flex:1;" onclick="hearWord()">Hear</button>
      <button style="flex:1;" onclick="startTest()">Test</button>
    </div>

    <div id="result"></div>
    <div id="score"></div>
  </div>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <input id="term" placeholder="Word">
    <input id="meaning" placeholder="Meaning">
    <div class="modal-buttons">
      <button onclick="saveWord()">Save</button>
      <button onclick="closeModal()">Cancel</button>
    </div>
  </div>
</div>

<script>
let vocab = JSON.parse(localStorage.getItem("vocab") || "[]");
let showFav = false;
let pronunciation = false;

let currentWord = "";
let correctCount = 0;
let totalCount = 0;

/* IPA MINI DICT */
const IPA = {
  able:"/ˈeɪ.bəl/",
  about:"/əˈbaʊt/",
  above:"/əˈbʌv/",
  accept:"/əkˈsept/",
  achieve:"/əˈtʃiːv/",
  across:"/əˈkrɒs/"
};

function render() {
  const list = document.getElementById("list");
  list.innerHTML = "";

  let filtered = showFav ? vocab.filter(v => v.fav) : vocab;

  filtered.forEach((v, i) => {
    const div = document.createElement("div");
    div.className = "word";

    const term = document.createElement("div");
    term.className = "term";
    term.textContent = v.term;

    term.onclick = () => {
      if (pronunciation) setTestWord(v.term);
    };

    const meaning = document.createElement("div");
    meaning.className = "meaning";
    meaning.textContent = v.meaning;

    const actions = document.createElement("div");
    actions.className = "actions";

    const favBtn = document.createElement("button");
    favBtn.textContent = v.fav ? "★" : "☆";
    favBtn.onclick = () => {
      v.fav = !v.fav;
      save();
    };

    const delBtn = document.createElement("button");
    delBtn.textContent = "Delete";
    delBtn.onclick = () => {
      vocab.splice(i, 1);
      save();
    };

    actions.appendChild(favBtn);
    actions.appendChild(delBtn);

    div.appendChild(term);
    div.appendChild(meaning);
    div.appendChild(actions);
    list.appendChild(div);
  });

  document.getElementById("count").textContent =
    "Total vocabulary: " + vocab.length;
}

function save() {
  localStorage.setItem("vocab", JSON.stringify(vocab));
  render();
}

/* MODAL */
function openModal() {
  document.getElementById("modal").style.display = "flex";
}

function closeModal() {
  document.getElementById("modal").style.display = "none";
}

function saveWord() {
  const term = document.getElementById("term").value.trim();
  const meaning = document.getElementById("meaning").value.trim();
  if (!term) return;

  vocab.push({ term, meaning, fav: false });
  document.getElementById("term").value = "";
  document.getElementById("meaning").value = "";
  closeModal();
  save();
}

/* TOOLBAR */
function deleteAll() {
  if (confirm("Delete all vocabulary?")) {
    vocab = [];
    save();
  }
}

function showFavorites() {
  showFav = !showFav;
  render();
}

function togglePronunciation() {
  pronunciation = !pronunciation;
  document.getElementById("testPanel").style.display =
    pronunciation ? "block" : "none";
}

/* TEST ENGINE */
function setTestWord(word) {
  currentWord = word;
  document.getElementById("testWord").textContent = word;
  document.getElementById("testIPA").textContent =
    IPA[word.toLowerCase()] || "/";
}

function hearWord() {
  if (!currentWord) return;
  speechSynthesis.speak(new SpeechSynthesisUtterance(currentWord));
}

function startTest() {
  if (!currentWord) return;

  if (!("webkitSpeechRecognition" in window)) {
    alert("Speech recognition not supported");
    return;
  }

  const recognition = new webkitSpeechRecognition();
  recognition.lang = "en-US";
  recognition.start();

  recognition.onresult = e => {
    const spoken = e.results[0][0].transcript.toLowerCase();
    checkAnswer(spoken);
  };
}

function checkAnswer(spoken) {
  totalCount++;

  if (spoken === currentWord.toLowerCase()) {
    correctCount++;
    playCling();
    document.getElementById("result").innerHTML =
      "✔ <span style='color:#4caf50'>Correct</span>";
  } else {
    playBeep();
    document.getElementById("result").innerHTML =
      "✖ <span style='color:#f44336'>Wrong</span>";
  }

  const score = Math.round((correctCount / totalCount) * 100);
  document.getElementById("score").textContent =
    `Score: ${score}% (${correctCount}/${totalCount})`;
}

/* SOUNDS */
function playCling() {
  const a = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
  a.play();
}

function playBeep() {
  const a = new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg");
  a.play();
}

/* IMPORT EXPORT */
function exportData() {
  const blob = new Blob([JSON.stringify(vocab)], { type: "application/json" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "vocab.json";
  a.click();
}

function importData() {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = ".json";
  input.onchange = e => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = () => {
      vocab = JSON.parse(reader.result);
      save();
    };
    reader.readAsText(file);
  };
  input.click();
}

render();
</script>

</body>
</html>